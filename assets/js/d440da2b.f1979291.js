(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{113:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return l})),o.d(t,"metadata",(function(){return i})),o.d(t,"toc",(function(){return c})),o.d(t,"default",(function(){return p}));var r=o(3),n=o(7),a=(o(0),o(128)),l={id:"rbe-platforms",title:"RBE Platforms",sidebar_label:"RBE Platforms"},i={unversionedId:"rbe-platforms",id:"rbe-platforms",isDocsHomePage:!1,title:"RBE Platforms",description:"BuildBuddy default",source:"@site/../docs/rbe-platforms.md",slug:"/rbe-platforms",permalink:"/docs/rbe-platforms",editUrl:"https://github.com/buildbuddy-io/buildbuddy/edit/master/docs/../docs/rbe-platforms.md",version:"current",sidebar_label:"RBE Platforms",sidebar:"someSidebar",previous:{title:"RBE Setup",permalink:"/docs/rbe-setup"},next:{title:"RBE with GitHub Actions",permalink:"/docs/rbe-github-actions"}},c=[{value:"BuildBuddy default",id:"buildbuddy-default",children:[]},{value:"Using a custom Docker image",id:"using-a-custom-docker-image",children:[]},{value:"Specifying a custom executor pool",id:"specifying-a-custom-executor-pool",children:[]},{value:"Target level execution properties",id:"target-level-execution-properties",children:[]}],u={toc:c};function p(e){var t=e.components,o=Object(n.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},u,o,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"buildbuddy-default"},"BuildBuddy default"),Object(a.b)("p",null,"BuildBuddy's default platform is Ubuntu 16.04 with Java 8 installed. Building on our basic command can specify this platform with the ",Object(a.b)("inlineCode",{parentName:"p"},"--host_platform")," flag:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"--host_platform=@buildbuddy_toolchain//:platform\n")),Object(a.b)("h2",{id:"using-a-custom-docker-image"},"Using a custom Docker image"),Object(a.b)("p",null,"You can configure BuildBuddy RBE to use a custom docker image, by adding the following rule to a BUILD file:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},'platform(\n    name = "docker_image_platform",\n    constraint_values = [\n        "@bazel_tools//platforms:x86_64",\n        "@bazel_tools//platforms:linux",\n        "@bazel_tools//tools/cpp:clang",\n    ],\n    exec_properties = {\n        "OSFamily": "Linux",\n        "container-image": "docker://gcr.io/YOUR:IMAGE",\n    },\n)\n')),Object(a.b)("p",null,"Make sure to replace ",Object(a.b)("inlineCode",{parentName:"p"},"gcr.io/YOUR:IMAGE")," with your docker image url."),Object(a.b)("p",null,"You can then pass this configuration to BuildBuddy RBE with the following flag:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"--host_platform=//:docker_image_platform\n")),Object(a.b)("p",null,"This assumes you've placed this rule in your root BUILD file. If you place it elsewhere, make sure to update the path accordingly."),Object(a.b)("h2",{id:"specifying-a-custom-executor-pool"},"Specifying a custom executor pool"),Object(a.b)("p",null,"You can configure BuildBuddy RBE to use a custom executor pool, by adding the following rule to a BUILD file:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},'platform(\n    name = "gpu_platform",\n    constraint_values = [\n        "@bazel_tools//platforms:x86_64",\n        "@bazel_tools//platforms:linux",\n        "@bazel_tools//tools/cpp:clang",\n    ],\n    exec_properties = {\n        "OSFamily": "Linux",\n        "Pool": "my-gpu-pool",\n    },\n)\n')),Object(a.b)("p",null,"Make sure to replace ",Object(a.b)("inlineCode",{parentName:"p"},"my-gpu-pool")," with your pool name."),Object(a.b)("p",null,"You can then pass this configuration to BuildBuddy RBE with the following flag:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"--host_platform=//:gpu_platform\n")),Object(a.b)("p",null,"This assumes you've placed this rule in your root BUILD file. If you place it elsewhere, make sure to update the path accordingly."),Object(a.b)("p",null,"For instructions on how to deploy custom executor pools, we the ",Object(a.b)("a",{parentName:"p",href:"/docs/rbe-pools"},"RBE Executor Pools docs"),"."),Object(a.b)("h2",{id:"target-level-execution-properties"},"Target level execution properties"),Object(a.b)("p",null,"If you want different targets to run in different RBE environments, you can specify ",Object(a.b)("inlineCode",{parentName:"p"},"exec_properties")," at the target level. For example if you want to run one set of tests in a high-memory pool, or another set of targets on executors with GPUs."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},'go_test(\n    name = "memory_hogging_test",\n    srcs = ["memory_hogging_test.go"],\n    embed = [":go_default_library"],\n    exec_properties = {\n        "Pool": "high-memory-pool",\n    },\n)\n')))}p.isMDXComponent=!0},128:function(e,t,o){"use strict";o.d(t,"a",(function(){return s})),o.d(t,"b",(function(){return m}));var r=o(0),n=o.n(r);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var u=n.a.createContext({}),p=function(e){var t=n.a.useContext(u),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},s=function(e){var t=p(e.components);return n.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},b=n.a.forwardRef((function(e,t){var o=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),s=p(o),b=r,m=s["".concat(l,".").concat(b)]||s[b]||d[b]||a;return o?n.a.createElement(m,i(i({ref:t},u),{},{components:o})):n.a.createElement(m,i({ref:t},u))}));function m(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=o.length,l=new Array(a);l[0]=b;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<a;u++)l[u]=o[u];return n.a.createElement.apply(null,l)}return n.a.createElement.apply(null,o)}b.displayName="MDXCreateElement"}}]);