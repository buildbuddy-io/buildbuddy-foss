(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{107:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return s}));var a=n(3),i=n(7),r=(n(0),n(128)),o={id:"workflows-config",title:"Workflows configuration",sidebar_label:"Workflows configuration"},l={unversionedId:"workflows-config",id:"workflows-config",isDocsHomePage:!1,title:"Workflows configuration",description:"This page provides documentation for buildbuddy.yaml, which can be placed",source:"@site/../docs/workflows-config.md",slug:"/workflows-config",permalink:"/docs/workflows-config",editUrl:"https://github.com/buildbuddy-io/buildbuddy/edit/master/docs/../docs/workflows-config.md",version:"current",sidebar_label:"Workflows configuration"},c=[{value:"Example config",id:"example-config",children:[]},{value:"buildbuddy.yaml schema",id:"buildbuddyyaml-schema",children:[{value:"<code>BuildBuddyConfig</code>",id:"buildbuddyconfig",children:[]},{value:"<code>Action</code>",id:"action",children:[]},{value:"<code>Triggers</code>",id:"triggers",children:[]},{value:"<code>PushTrigger</code>",id:"pushtrigger",children:[]},{value:"<code>PullRequestTrigger</code>",id:"pullrequesttrigger",children:[]}]}],b={toc:c};function s(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This page provides documentation for ",Object(r.b)("inlineCode",{parentName:"p"},"buildbuddy.yaml"),", which can be placed\nat the root of your git repo to configure BuildBuddy workflow execution."),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"The configuration in ",Object(r.b)("inlineCode",{parentName:"p"},"buildbuddy.yaml")," only takes effect after you\n",Object(r.b)("a",{parentName:"p",href:"workflows-setup#enable-workflows-for-a-repo"},"enable workflows for the repo"),"."))),Object(r.b)("h2",{id:"example-config"},"Example config"),Object(r.b)("p",null,"You can copy this example config as a starting point for your own ",Object(r.b)("inlineCode",{parentName:"p"},"buildbuddy.yaml"),":"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml"},'actions:\n  - name: "Test all targets"\n    triggers:\n      push:\n        branches:\n          - "main"\n      pull_request:\n        branches:\n          - "main"\n    bazel_commands:\n      - "test //... --build_metadata=ROLE=CI --bes_backend=grpcs://cloud.buildbuddy.io --bes_results_url=https://app.buildbuddy.io/invocation/"\n')),Object(r.b)("p",null,"This config is equivalent to the default config that we use if you do\nnot have a ",Object(r.b)("inlineCode",{parentName:"p"},"buildbuddy.yaml"),", with some exceptions:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"This example uses ",Object(r.b)("inlineCode",{parentName:"li"},'"main"')," for the branch name -- if you copy this config,\nbe sure to replace that with the name of your main branch. By default, we\nrun the above bazel command when any branch is pushed."),Object(r.b)("li",{parentName:"ul"},"By default, we also pass ",Object(r.b)("inlineCode",{parentName:"li"},"--remote_header=x-buildbuddy-api-key=<YOUR_API_KEY>"),",\nso that workflow builds show up in your BuildBuddy org. For security reasons,\nwe only do this if your repo is private.")),Object(r.b)("p",null,"Other points to note:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Remote cache and remote execution (RBE) require additional configuration.\nThe configuration steps are the same as when running Bazel locally.\nSee the ",Object(r.b)("strong",{parentName:"li"},"Setup")," page in the BuildBuddy UI."),Object(r.b)("li",{parentName:"ul"},"Bazel commands are run directly in your workspace, which means that your\n",Object(r.b)("inlineCode",{parentName:"li"},".bazelrc")," is respected. If you have lots of flags, we recommend adding\nthem to your ",Object(r.b)("inlineCode",{parentName:"li"},".bazelrc")," instead of adding them in this YAML config."),Object(r.b)("li",{parentName:"ul"},"We run your commands with a ",Object(r.b)("a",{parentName:"li",href:"https://github.com/bazelbuild/bazelisk"},"bazelisk"),"-compatible\nwrapper so that your ",Object(r.b)("inlineCode",{parentName:"li"},".bazelversion")," file is respected. If\n",Object(r.b)("inlineCode",{parentName:"li"},".bazelversion")," is missing, the latest version of Bazel is used. We\nalways recommend including a ",Object(r.b)("inlineCode",{parentName:"li"},".bazelversion")," in your repo to prevent\nproblems caused by using conflicting versions of Bazel in different\nbuild environments.")),Object(r.b)("h2",{id:"buildbuddyyaml-schema"},"buildbuddy.yaml schema"),Object(r.b)("h3",{id:"buildbuddyconfig"},Object(r.b)("inlineCode",{parentName:"h3"},"BuildBuddyConfig")),Object(r.b)("p",null,"The top-level BuildBuddy workflow config, which specifies bazel commands\nthat can be run on a repo, as well as the events that trigger those commands."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Fields:")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"actions"))," (",Object(r.b)("a",{parentName:"li",href:"#action"},Object(r.b)("inlineCode",{parentName:"a"},"Action"))," list): List of actions that can be triggered by BuildBuddy.\nEach action corresponds to a separate check on GitHub.\nIf multiple actions are matched for a given event, the actions are run in\norder. If an action fails, subsequent actions will still be executed.")),Object(r.b)("h3",{id:"action"},Object(r.b)("inlineCode",{parentName:"h3"},"Action")),Object(r.b)("p",null,"A named group of Bazel commands that run when triggered."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Fields:")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"name"))," (",Object(r.b)("inlineCode",{parentName:"li"},"string"),"): A name unique to this config, which shows up as the name of the check\nin GitHub."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"triggers"))," (",Object(r.b)("a",{parentName:"li",href:"#triggers"},Object(r.b)("inlineCode",{parentName:"a"},"Triggers")),"): The triggers that should cause this action to be run."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"bazel_commands"))," (",Object(r.b)("inlineCode",{parentName:"li"},"string")," list): Bazel commands to be run in order.\nIf a command fails, subsequent ones are not run, and the action is\nreported as failed. Otherwise, the action is reported as succeeded.")),Object(r.b)("h3",{id:"triggers"},Object(r.b)("inlineCode",{parentName:"h3"},"Triggers")),Object(r.b)("p",null,"Defines whether an action should run when a branch is pushed to the repo."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Fields:")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"push"))," (",Object(r.b)("a",{parentName:"li",href:"#push-trigger"},Object(r.b)("inlineCode",{parentName:"a"},"PushTrigger")),"): Configuration for push events associated with the repo.\nThis is mostly useful for reporting commit statuses that show up on the\nhome page of the repo."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"pull_request"))," (",Object(r.b)("a",{parentName:"li",href:"#pull-request-trigger"},Object(r.b)("inlineCode",{parentName:"a"},"PullRequestTrigger")),"):\nConfiguration for pull request events associated with the repo.\nThis is required if you want to use BuildBuddy to report the status of\nthis action on pull requests, and optionally prevent pull requests from\nbeing merged if the action fails.")),Object(r.b)("h3",{id:"pushtrigger"},Object(r.b)("inlineCode",{parentName:"h3"},"PushTrigger")),Object(r.b)("p",null,"Defines whether an action should execute when a branch is pushed."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Fields:")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"branches"))," (",Object(r.b)("inlineCode",{parentName:"li"},"string")," list): The branches that, when pushed to, will trigger the action.")),Object(r.b)("h3",{id:"pullrequesttrigger"},Object(r.b)("inlineCode",{parentName:"h3"},"PullRequestTrigger")),Object(r.b)("p",null,"Defines whether an action should execute when a pull request (PR) branch is\npushed."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Fields:")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"branches"))," (",Object(r.b)("inlineCode",{parentName:"li"},"string")," list): The ",Object(r.b)("em",{parentName:"li"},"target")," branches of a pull request.\nFor example, if this is set to ",Object(r.b)("inlineCode",{parentName:"li"},'[ "v1", "v2" ]'),", then the\nassociated action is only run when a PR wants to merge a branch ",Object(r.b)("em",{parentName:"li"},"into"),"\nthe ",Object(r.b)("inlineCode",{parentName:"li"},"v1")," branch or the ",Object(r.b)("inlineCode",{parentName:"li"},"v2")," branch.")))}s.isMDXComponent=!0},128:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var b=i.a.createContext({}),s=function(e){var t=i.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return i.a.createElement(b.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},p=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),u=s(n),p=a,m=u["".concat(o,".").concat(p)]||u[p]||d[p]||r;return n?i.a.createElement(m,l(l({ref:t},b),{},{components:n})):i.a.createElement(m,l({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var b=2;b<r;b++)o[b]=n[b];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);